<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…­åˆå½©å…¨ç³»åˆ—åˆ†æé¢„æµ‹å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* å…è´£å£°æ˜ç•Œé¢ */
        .disclaimer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .disclaimer-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .disclaimer-title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 30px;
        }

        .disclaimer-content {
            line-height: 1.8;
            color: #333;
            font-size: 14px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .disclaimer-content h3 {
            color: #e74c3c;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .disclaimer-content p {
            margin-bottom: 10px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ä¸»ç•Œé¢ */
        .main-container {
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
        }

        .header-info {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .header h1 {
                font-size: 20px;
            }

            .card {
                padding: 15px;
            }

            .period-number {
                font-size: 24px;
            }

            .countdown {
                font-size: 16px;
            }

            .number-ball {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .history-table {
                font-size: 12px;
            }

            .history-table th,
            .history-table td {
                padding: 8px;
            }

            .ai-config-input {
                flex-direction: column;
            }

            .ai-config-input input {
                width: 100%;
            }

            .ai-config-buttons {
                width: 100%;
            }

            .ai-config-buttons button {
                flex: 1;
            }

            .modal-content {
                max-width: 100%;
                max-height: 95vh;
            }

            .modal-body {
                font-size: 12px;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .period-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .period-number {
            font-size: 32px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .countdown {
            font-size: 20px;
            color: #667eea;
            font-weight: bold;
            margin: 15px 0;
        }

        .date-info {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        .result-display {
            margin-top: 20px;
        }

        .numbers-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }

        .number-ball {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .number-ball.red {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .number-ball.blue {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .number-ball.green {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .prediction-section {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px dashed #e74c3c;
        }

        .prediction-locked {
            text-align: center;
            color: #999;
            font-size: 16px;
            padding: 40px 20px;
        }

        .prediction-locked .lock-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .history-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        .history-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .history-table tr:hover {
            background: #f8f9fa;
        }

        .history-table tr:nth-child(even) {
            background: #fafafa;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .card-key-section {
            background: linear-gradient(135deg, #fff9e6 0%, #fff5cc 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #f39c12;
        }

        .card-key-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .card-key-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .card-key-input button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .card-key-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .verified-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s;
            max-width: 300px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            background: #27ae60;
        }

        .toast.error {
            background: #e74c3c;
        }

        .toast.warning {
            background: #f39c12;
        }

        /* AIé…ç½®åŒºåŸŸ */
        .ai-config-section {
            background: linear-gradient(135deg, #f0f5ff 0%, #e6f0ff 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #9b59b6;
        }

        .ai-config-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .ai-config-input input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Consolas', monospace;
        }

        .ai-config-input input:focus {
            outline: none;
            border-color: #9b59b6;
            box-shadow: 0 0 0 3px rgba(155, 89, 182, 0.1);
        }

        .ai-config-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-ai-save {
            padding: 12px 25px;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-ai-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-ai-predict {
            padding: 12px 25px;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-ai-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }

        .btn-ai-predict:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* AIé¢„æµ‹å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 800px;
            max-height: 90vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            font-size: 14px;
            line-height: 1.8;
            color: #333;
        }

        .modal-body pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
        }

        .ai-prediction-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .ai-loading {
            text-align: center;
            padding: 40px;
        }

        .ai-loading .spinner {
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <!-- å…è´£å£°æ˜ç•Œé¢ -->
    <div class="disclaimer-container" id="disclaimerContainer">
        <div class="disclaimer-box">
            <h2 class="disclaimer-title">âš ï¸ å…è´£å£°æ˜</h2>
            <div class="disclaimer-content">
                <h3>é‡è¦æç¤º</h3>
                <p>åœ¨ä½¿ç”¨æœ¬å·¥å…·ä¹‹å‰ï¼Œè¯·æ‚¨ä»”ç»†é˜…è¯»ä»¥ä¸‹å…è´£å£°æ˜ã€‚ç‚¹å‡»"æˆ‘åŒæ„"å³è¡¨ç¤ºæ‚¨å·²å……åˆ†ç†è§£å¹¶åŒæ„æ¥å—æœ¬å£°æ˜çš„å…¨éƒ¨å†…å®¹ã€‚</p>
                
                <h3>1. å·¥å…·æ€§è´¨</h3>
                <p>æœ¬å·¥å…·ä»…ç”¨äºæ•°æ®åˆ†æå’Œé¢„æµ‹å‚è€ƒï¼Œä¸æ„æˆä»»ä½•æŠ•æ³¨å»ºè®®æˆ–ä¿è¯ã€‚æ‰€æœ‰é¢„æµ‹ç»“æœåŸºäºå†å²æ•°æ®åˆ†æï¼Œä»…ä¾›å‚è€ƒï¼Œä¸ä¿è¯å‡†ç¡®æ€§ã€‚</p>
                
                <h3>2. é£é™©æç¤º</h3>
                <p>ä»»ä½•å½¢å¼çš„åšå½©æ´»åŠ¨å‡å­˜åœ¨é£é™©ï¼Œå¯èƒ½å¯¼è‡´è´¢äº§æŸå¤±ã€‚ä½¿ç”¨æœ¬å·¥å…·è¿›è¡Œä»»ä½•æŠ•æ³¨å†³ç­–æ‰€äº§ç”Ÿçš„åæœï¼Œå‡ç”±ç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…ã€‚</p>
                
                <h3>3. æ•°æ®å‡†ç¡®æ€§</h3>
                <p>æœ¬å·¥å…·æä¾›çš„æ•°æ®å’Œåˆ†æç»“æœå¯èƒ½å­˜åœ¨è¯¯å·®ï¼Œä¸ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ã€‚ç”¨æˆ·åº”è‡ªè¡Œæ ¸å®ç›¸å…³ä¿¡æ¯çš„çœŸå®æ€§ã€‚</p>
                
                <h3>4. ä½¿ç”¨é™åˆ¶</h3>
                <p>æœ¬å·¥å…·ä»…ä¾›ä¸ªäººå­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œä¸å¾—ç”¨äºä»»ä½•å•†ä¸šç›®çš„æˆ–éæ³•ç”¨é€”ã€‚ç¦æ­¢å°†æœ¬å·¥å…·ç”¨äºä»»ä½•å½¢å¼çš„èµŒåšæ´»åŠ¨ã€‚</p>
                
                <h3>5. å…è´£æ¡æ¬¾</h3>
                <p>å¼€å‘è€…ä¸å¯¹å› ä½¿ç”¨æœ¬å·¥å…·è€Œäº§ç”Ÿçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥æŸå¤±æ‰¿æ‹…è´£ä»»ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºè´¢äº§æŸå¤±ã€æ•°æ®ä¸¢å¤±ç­‰ã€‚</p>
                
                <h3>6. æ³•å¾‹å£°æ˜</h3>
                <p>ç”¨æˆ·åº”éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ï¼Œä¸å¾—å°†æœ¬å·¥å…·ç”¨äºä»»ä½•è¿æ³•æ´»åŠ¨ã€‚å¦‚å› è¿åæ³•å¾‹æ³•è§„è€Œäº§ç”Ÿçš„ä»»ä½•åæœï¼Œç”±ç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…ã€‚</p>
                
                <h3>7. æœåŠ¡å˜æ›´</h3>
                <p>å¼€å‘è€…ä¿ç•™éšæ—¶ä¿®æ”¹ã€æš‚åœæˆ–ç»ˆæ­¢æœ¬å·¥å…·æœåŠ¡çš„æƒåˆ©ï¼Œæ— éœ€æå‰é€šçŸ¥ç”¨æˆ·ã€‚</p>
                </div>
            <button type="button" class="btn btn-primary" id="agreeBtn" onclick="agreeDisclaimer()">æˆ‘åŒæ„</button>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-container" id="mainContainer">
        <div class="container">
            <div class="header">
                <h1>ğŸ¯ å…­åˆå½©å…¨ç³»åˆ—åˆ†æé¢„æµ‹å·¥å…·</h1>
                <div class="header-info">
                    <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span>è¿è¡Œä¸­</span>
                    </div>
                    <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
                </div>
            </div>

            <div class="content">
                <!-- å·¦ä¾§ï¼šå®æ—¶ä¿¡æ¯ -->
                <div>
                    <!-- DeepSeek AIé…ç½®åŒºåŸŸ -->
                    <div class="card">
                        <div class="ai-config-section">
                            <div class="card-title">
                                ğŸ¤– AIæ™ºèƒ½é¢„æµ‹
                            </div>
                            <div class="ai-config-buttons" style="justify-content: center;">
                                    <button class="btn-ai-predict" id="aiPredictBtn" onclick="aiPredict()">ğŸš€ AIæ™ºèƒ½é¢„æµ‹</button>
                            </div>
                        </div>
                    </div>


                    <!-- å½“å‰æœŸå· -->
                    <div class="card">
                        <div class="card-title">ğŸ“… å½“å‰æœŸå·</div>
                        <div class="period-display">
                            <div class="period-number" id="currentPeriod">è·å–ä¸­...</div>
                            <div class="countdown" id="countdown">--</div>
                            <div class="date-info" id="currentDate"></div>
                            <div class="date-info" id="lunarDate"></div>
                        </div>
                    </div>

                    <!-- ä¸Šä¸€æœŸç»“æœ -->
                    <div class="card">
                        <div class="card-title">ğŸ² ä¸Šä¸€æœŸå¼€å¥–ç»“æœ</div>
                        <div class="result-display" id="lastResult">
                            <div class="loading">
                                <div class="spinner"></div>
                                <div>åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                    </div>

                    <!-- é¢„æµ‹ç»“æœ -->
                    <div class="card">
                        <div class="card-title">ğŸ”® ä¸‹æœŸé¢„æµ‹</div>
                        <div id="predictionSection">
                            <div class="prediction-locked">
                                <div class="lock-icon">ğŸ”’</div>
                                <div>ç‚¹å‡»AIæ™ºèƒ½é¢„æµ‹æŸ¥çœ‹é¢„æµ‹ç»“æœ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šå†å²è®°å½• -->
                <div>
                    <div class="card">
                        <div class="card-title">ğŸ“œ å†å²å¼€å¥–è®°å½• <span id="historyCount" style="font-size: 14px; color: #999; font-weight: normal;">ï¼ˆå…± 0 æ¡ï¼‰</span></div>
                        <button class="refresh-btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                        <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                            <table class="history-table">
                                <thead>
                                    <tr>
                                        <th>æœŸå·</th>
                                        <th>å¼€å¥–æ—¶é—´</th>
                                        <th>å·ç </th>
                                        <th>ç‰¹ç </th>
                                        <th>é¢„æµ‹ç»“æœ</th>
                                        <th>èƒœç‡</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTableBody">
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 40px;">
                                            <div class="loading">
                                                <div class="spinner"></div>
                                                <div>åŠ è½½å†å²è®°å½•...</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AIé¢„æµ‹å¼¹çª— -->
    <div class="modal-overlay" id="aiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ¤– AIæ™ºèƒ½é¢„æµ‹ç»“æœ</h2>
                <button class="modal-close" onclick="closeAIModal()">Ã—</button>
            </div>
            <div class="modal-body" id="aiModalBody">
                <div class="ai-loading">
                    <div class="spinner"></div>
                    <div>AIæ­£åœ¨åˆ†ææ•°æ®ï¼Œè¯·ç¨å€™...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // çŠ¶æ€ç®¡ç†
        const state = {
            isLoggedIn: false,
            currentPeriod: null,
            nextDrawTime: null,
            lastResult: null,
            history: [],
            prediction: null,
            refreshInterval: null,
            deepseekToken: 'sk-69bec2d36aec47be8e0473b3157e0031'
        };

        // DeepSeek APIé…ç½®
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';

        // åŒæ„å…è´£å£°æ˜
        function agreeDisclaimer() {
                state.isLoggedIn = true;
            document.getElementById('disclaimerContainer').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'block';
                
                // åˆå§‹åŒ–æ•°æ®
                initData();
            }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                state.isLoggedIn = false;
                document.getElementById('disclaimerContainer').style.display = 'flex';
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('predictionSection').innerHTML = `
                    <div class="prediction-locked">
                        <div class="lock-icon">ğŸ”’</div>
                        <div>ç‚¹å‡»AIæ™ºèƒ½é¢„æµ‹æŸ¥çœ‹é¢„æµ‹ç»“æœ</div>
                    </div>
                `;
                
                // æ¸…é™¤å®šæ—¶å™¨
                if (state.refreshInterval) {
                    clearInterval(state.refreshInterval);
                }
            }
        }

        // åˆå§‹åŒ–æ•°æ®
        async function initData() {
            await fetchLotteryData();
            await fetchHistory();
            updateDateDisplay();
            startCountdown();
            
            // æ¯60ç§’è‡ªåŠ¨åˆ·æ–°
            state.refreshInterval = setInterval(() => {
                fetchLotteryData();
                fetchHistory();
            }, 60000);
        }

        // å…³é—­AIå¼¹çª—
        function closeAIModal() {
            document.getElementById('aiModal').classList.remove('show');
        }

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.getElementById('aiModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAIModal();
            }
        });

        // æ„å»ºé¢„æµ‹æç¤ºè¯ï¼ˆå‚è€ƒPythonä»£ç ï¼‰
        function buildPredictionPrompt() {
            const lastResult = state.lastResult;
            const history = state.history.slice(0, 50);
            
            // æ„å»ºå†å²è®°å½•æ–‡æœ¬
            let historyText = '';
            history.forEach((record, idx) => {
                const period = record.period || 'N/A';
                const numbers = record.numbers || [];
                const special = record.special || 'N/A';
                const numbersStr = numbers.map(n => String(n).padStart(2, '0')).join(' ');
                historyText += `${idx + 1}. æœŸå·ï¼š${period} | æ­£ç ï¼š${numbersStr} | ç‰¹ç ï¼š${String(special).padStart(2, '0')}\n`;
            });
            
            // æ„å»ºä¸Šä¸€æœŸç»“æœæ–‡æœ¬
            let lastResultText = '';
            if (lastResult) {
                const period = lastResult.period || 'N/A';
                const numbers = lastResult.numbers || [];
                const special = lastResult.special || 'N/A';
                const numbersStr = numbers.map(n => String(n).padStart(2, '0')).join(' ');
                lastResultText = `æœŸå·ï¼š${period} | æ­£ç ï¼š${numbersStr} | ç‰¹ç ï¼š${String(special).padStart(2, '0')}`;
            }
            
            // è·å–ç”Ÿè‚–æ˜ å°„ï¼ˆç®€åŒ–ç‰ˆï¼‰
            const zodiacMapping = 'é¼ (01,13,25,37,49)ã€ç‰›(02,14,26,38)ã€è™(03,15,27,39)ã€å…”(04,16,28,40)ã€é¾™(05,17,29,41)ã€è›‡(06,18,30,42)ã€é©¬(07,19,31,43)ã€ç¾Š(08,20,32,44)ã€çŒ´(09,21,33,45)ã€é¸¡(10,22,34,46)ã€ç‹—(11,23,35,47)ã€çŒª(12,24,36,48)';
            
            const prompt = `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å…­åˆå½©æ•°æ®åˆ†æä¸“å®¶ï¼Œæ‹¥æœ‰20å¹´ä»¥ä¸Šçš„æ•°æ®åˆ†æç»éªŒã€‚è¯·æ ¹æ®ä»¥ä¸‹å†å²å¼€å¥–æ•°æ®ï¼Œè¿›è¡Œä¸“ä¸šçš„æ–°æ¾³é—¨å…­åˆå½©é¢„æµ‹åˆ†æã€‚

ã€å½©ç§ä¿¡æ¯ã€‘
å½“å‰åˆ†æçš„å½©ç§ï¼šæ–°æ¾³é—¨å…­åˆå½©
å¼€å¥–é¢‘ç‡ï¼šæ–°æ¾³é—¨å…­åˆå½©ï¼Œæ¯å¤©å¼€å¥–ä¸€æ¬¡

ã€ä¸Šä¸€æœŸå¼€å¥–ç»“æœã€‘
${lastResultText || 'æš‚æ— æ•°æ®'}

ã€å†å²å¼€å¥–è®°å½•ï¼ˆæœ€è¿‘50æœŸï¼ŒæŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼‰ã€‘
${historyText || 'æš‚æ— å†å²æ•°æ®'}

ã€åˆ†æè¦æ±‚ã€‘
è¯·åŸºäºä»¥ä¸Šæ•°æ®ï¼Œè¿ç”¨ä»¥ä¸‹åˆ†ææ–¹æ³•è¿›è¡Œç»¼åˆé¢„æµ‹ï¼š

1. **å·ç èµ°åŠ¿åˆ†æ**ï¼šåˆ†ææ­£ç å’Œç‰¹ç çš„å‡ºç°é¢‘ç‡ã€å†·çƒ­å·ã€é—æ¼å€¼
2. **æ³¢è‰²åˆ†æ**ï¼šçº¢æ³¢(1,2,7,8,12,13,18,19,23,24,29,30,34,35,40,45,46)ã€è“æ³¢(3,4,9,10,14,15,20,25,26,31,36,37,41,42,47,48)ã€ç»¿æ³¢(5,6,11,16,17,21,22,27,28,32,33,38,39,43,44,49)
3. **ç”Ÿè‚–åˆ†æ**ï¼š${zodiacMapping}
4. **äº”è¡Œåˆ†æ**ï¼šé‡‘(2,3,10,11,24,25,32,33,40,41)ã€æœ¨(6,7,14,15,22,23,36,37,44,45)ã€æ°´(12,13,20,21,28,29,42,43)ã€ç«(1,8,9,16,17,30,31,38,39,46,47)ã€åœŸ(4,5,18,19,26,27,34,35,48,49)
5. **å°¾æ•°åˆ†æ**ï¼šåˆ†æå°¾æ•°0-9çš„å‡ºç°è§„å¾‹
6. **å¤§å°åˆ†æ**ï¼šå¤§(25-49)ã€å°(1-24)
7. **å•åŒåˆ†æ**ï¼šå•æ•°ã€åŒæ•°
8. **è¿ç åˆ†æ**ï¼šè¿ç»­å·ç çš„å‡ºç°è§„å¾‹
9. **è¿è‚–åˆ†æ**ï¼šè¿ç»­ç”Ÿè‚–çš„å‡ºç°è§„å¾‹
10. **è¿å°¾åˆ†æ**ï¼šè¿ç»­å°¾æ•°çš„å‡ºç°è§„å¾‹
11. **æ—¶é—´åºåˆ—åˆ†æ**ï¼šåˆ†æé•¿æœŸè¶‹åŠ¿å’Œå‘¨æœŸæ€§è§„å¾‹

ã€é¢„æµ‹è¾“å‡ºæ ¼å¼ã€‘
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºé¢„æµ‹ç»“æœï¼š

{
    "æ­£ç ": [å·ç 1, å·ç 2, å·ç 3, å·ç 4, å·ç 5, å·ç 6],
    "ç‰¹ç ": [ç‰¹ç 1, ç‰¹ç 2, ç‰¹ç 3, ç‰¹ç 4, ç‰¹ç 5, ç‰¹ç 6, ç‰¹ç 7, ç‰¹ç 8, ç‰¹ç 9, ç‰¹ç 10],
    "ä¸€è‚–": "ç”Ÿè‚–åç§°",
    "ç‰¹è‚–": "ç”Ÿè‚–åç§°",
    "è¿è‚–": ["ç”Ÿè‚–1", "ç”Ÿè‚–2", "ç”Ÿè‚–3"],
    "è¿å°¾": ["å°¾æ•°1", "å°¾æ•°2", "å°¾æ•°3"]
}

è¯·ç¡®ä¿ï¼š
1. æ­£ç ä¸º6ä¸ªä¸é‡å¤çš„å·ç ï¼ˆ1-49ï¼‰
2. ç‰¹ç ä¸º10ä¸ªä¸é‡å¤çš„å·ç ï¼ˆ1-49ï¼‰ï¼Œä¸èƒ½ä¸æ­£ç é‡å¤ï¼Œå¿…é¡»åŸºäºå†å²è®°å½•åˆ†æç”Ÿæˆ
3. æ‰€æœ‰å·ç éƒ½åœ¨1-49èŒƒå›´å†…
4. åªè¾“å‡ºJSONæ ¼å¼ï¼Œä¸è¦æœ‰å…¶ä»–æ–‡å­—`;

            return prompt;
        }

        // è·å–å·ç å¯¹åº”çš„ç”Ÿè‚–
        function getZodiac(number) {
            const zodiacMap = {
                1: 'é¼ ', 13: 'é¼ ', 25: 'é¼ ', 37: 'é¼ ', 49: 'é¼ ',
                2: 'ç‰›', 14: 'ç‰›', 26: 'ç‰›', 38: 'ç‰›',
                3: 'è™', 15: 'è™', 27: 'è™', 39: 'è™',
                4: 'å…”', 16: 'å…”', 28: 'å…”', 40: 'å…”',
                5: 'é¾™', 17: 'é¾™', 29: 'é¾™', 41: 'é¾™',
                6: 'è›‡', 18: 'è›‡', 30: 'è›‡', 42: 'è›‡',
                7: 'é©¬', 19: 'é©¬', 31: 'é©¬', 43: 'é©¬',
                8: 'ç¾Š', 20: 'ç¾Š', 32: 'ç¾Š', 44: 'ç¾Š',
                9: 'çŒ´', 21: 'çŒ´', 33: 'çŒ´', 45: 'çŒ´',
                10: 'é¸¡', 22: 'é¸¡', 34: 'é¸¡', 46: 'é¸¡',
                11: 'ç‹—', 23: 'ç‹—', 35: 'ç‹—', 47: 'ç‹—',
                12: 'çŒª', 24: 'çŒª', 36: 'çŒª', 48: 'çŒª'
            };
            return zodiacMap[number] || '';
        }

        // æ ¼å¼åŒ–AIé¢„æµ‹ç»“æœæ˜¾ç¤ºï¼ˆç”¨äºä¸‹æœŸé¢„æµ‹åŒºåŸŸï¼‰
        function formatAIPredictionForSection(predictionData) {
            let html = '<div class="prediction-section">';
            
            // æ­£ç 
            if (predictionData.æ­£ç  && Array.isArray(predictionData.æ­£ç )) {
                html += '<div style="margin-bottom: 15px;"><strong>é¢„æµ‹å·ç ï¼š</strong></div>';
                html += '<div class="numbers-container">';
                predictionData.æ­£ç .forEach(num => {
                    const color = getNumberColor(num);
                    html += `<div class="number-ball ${color}">${String(num).padStart(2, '0')}</div>`;
                });
                html += '</div>';
            }
            
            // ç‰¹ç ï¼ˆ10ä¸ªï¼‰
            if (predictionData.ç‰¹ç  && Array.isArray(predictionData.ç‰¹ç )) {
                html += '<div style="margin-top: 20px; margin-bottom: 15px;"><strong>é¢„æµ‹ç‰¹ç ï¼ˆ10ä¸ªï¼‰ï¼š</strong></div>';
                html += '<div class="numbers-container">';
                predictionData.ç‰¹ç .forEach(num => {
                    const color = getNumberColor(num);
                    html += `<div class="number-ball ${color}">${String(num).padStart(2, '0')}</div>`;
                });
                html += '</div>';
            }
            
            // ä¸€è‚–ã€ç‰¹è‚–
            if (predictionData.ä¸€è‚–) {
                html += `<div style="margin-top: 20px; margin-bottom: 10px;"><strong>ğŸ‰ ä¸€è‚–ï¼š</strong><span style="font-size: 18px; color: #e74c3c; font-weight: bold;">${predictionData.ä¸€è‚–}</span></div>`;
            }
            if (predictionData.ç‰¹è‚–) {
                html += `<div style="margin-bottom: 10px;"><strong>â­ ç‰¹è‚–ï¼š</strong><span style="font-size: 18px; color: #e74c3c; font-weight: bold;">${predictionData.ç‰¹è‚–}</span></div>`;
            }
            if (predictionData.è¿è‚– && Array.isArray(predictionData.è¿è‚–) && predictionData.è¿è‚–.length > 0) {
                html += `<div style="margin-bottom: 10px;"><strong>ğŸ”— è¿è‚–ï¼š</strong><span style="font-size: 16px; color: #667eea; font-weight: bold;">${predictionData.è¿è‚–.join('ã€')}</span></div>`;
                    }
            if (predictionData.è¿å°¾ && Array.isArray(predictionData.è¿å°¾) && predictionData.è¿å°¾.length > 0) {
                html += `<div style="margin-bottom: 10px;"><strong>ğŸ”¢ è¿å°¾ï¼š</strong><span style="font-size: 16px; color: #667eea; font-weight: bold;">${predictionData.è¿å°¾.join('ã€')}</span></div>`;
            }
            
            html += '</div>';
            return html;
        }

        // AIé¢„æµ‹
        async function aiPredict() {
            // æ£€æŸ¥Token
            if (!state.deepseekToken) {
                showToast('è¯·å…ˆé…ç½®DeepSeek API Tokenï¼', 'warning');
                return;
            }
            
            // æ£€æŸ¥å†å²æ•°æ®
            if (!state.history || state.history.length < 10) {
                showToast('å†å²æ•°æ®ä¸è¶³ï¼Œè‡³å°‘éœ€è¦10æ¡å†å²è®°å½•ï¼', 'warning');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const predictBtn = document.getElementById('aiPredictBtn');
            const predictionSection = document.getElementById('predictionSection');
            
            predictionSection.innerHTML = '<div class="loading"><div class="spinner"></div><div>AIæ­£åœ¨åˆ†ææ•°æ®ï¼Œè¯·ç¨å€™...</div></div>';
            predictBtn.disabled = true;
            predictBtn.textContent = 'åˆ†æä¸­...';
            
            try {
                // æ„å»ºæç¤ºè¯
                const prompt = buildPredictionPrompt();
                
                // è°ƒç”¨DeepSeek API
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${state.deepseekToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ–°æ¾³é—¨å…­åˆå½©æ•°æ®åˆ†æä¸“å®¶ï¼Œæ“…é•¿é€šè¿‡å†å²æ•°æ®åˆ†æå’Œé¢„æµ‹ã€‚æ–°æ¾³é—¨å…­åˆå½©æ¯å¤©å¼€å¥–ä¸€æ¬¡ï¼Œéœ€è¦åˆ†æé•¿æœŸè¶‹åŠ¿å’Œå‘¨æœŸæ€§è§„å¾‹ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§è¦æ±‚çš„JSONæ ¼å¼è¾“å‡ºé¢„æµ‹ç»“æœï¼Œåªè¾“å‡ºJSONï¼Œä¸è¦åŒ…å«ä»»ä½•åˆ†æè¯´æ˜ã€‚ç‰¹ç å¿…é¡»æ˜¯1-49ä¹‹é—´çš„æ•´æ•°ï¼Œä¸èƒ½æ˜¯01-10è¿™æ ·çš„æ ¼å¼ã€‚'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`APIè¯·æ±‚å¤±è´¥ï¼š${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                
                if (!result.choices || result.choices.length === 0) {
                    throw new Error('AIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
                }
                
                const content = result.choices[0].message.content;
                
                // å°è¯•è§£æJSON
                try {
                    // æ¸…ç†å†…å®¹ï¼šç§»é™¤markdownä»£ç å—æ ‡è®°
                    let cleanedContent = content.trim();
                    cleanedContent = cleanedContent.replace(/^```json\s*/i, '');
                    cleanedContent = cleanedContent.replace(/^```\s*/i, '');
                    cleanedContent = cleanedContent.replace(/\s*```$/i, '');
                    cleanedContent = cleanedContent.trim();
                    
                    // å°è¯•å¤šç§æ–¹å¼æå–JSON
                    let jsonStr = null;
                    
                    // æ–¹æ³•1: ç›´æ¥å°è¯•è§£ææ•´ä¸ªå†…å®¹
                    if (cleanedContent.startsWith('{')) {
                        jsonStr = cleanedContent;
                    } else {
                        // æ–¹æ³•2: æŸ¥æ‰¾ç¬¬ä¸€ä¸ª{åˆ°æœ€åä¸€ä¸ª}
                        const jsonMatch = cleanedContent.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                            jsonStr = jsonMatch[0];
                        }
                    }
                    
                    if (!jsonStr) {
                        throw new Error('æœªæ‰¾åˆ°JSONæ ¼å¼æ•°æ®');
                    }
                    
                    // ä¿®å¤å¸¸è§çš„JSONæ ¼å¼é—®é¢˜
                    // 1. ä¿®å¤ä¸­æ–‡å¼•å·
                    jsonStr = jsonStr.replace(/[""]/g, '"');
                    jsonStr = jsonStr.replace(/['']/g, "'");
                    // 2. ç§»é™¤æ³¨é‡Šï¼ˆå•è¡Œå’Œå¤šè¡Œï¼‰
                    jsonStr = jsonStr.replace(/\/\/.*$/gm, '');
                    jsonStr = jsonStr.replace(/\/\*[\s\S]*?\*\//g, '');
                    // 3. ä¿®å¤å°¾éšé€—å·
                    jsonStr = jsonStr.replace(/,(\s*[}\]])/g, '$1');
                    // 4. ç¡®ä¿é”®åç”¨åŒå¼•å·
                    jsonStr = jsonStr.replace(/([{,]\s*)(['"]?)(\w+)(['"]?\s*):/g, '$1"$3":');
                    
                    // å°è¯•è§£æJSON
                    let predictionData;
                    try {
                        predictionData = JSON.parse(jsonStr);
                    } catch (parseError) {
                        // å¦‚æœè§£æå¤±è´¥ï¼Œå°è¯•æ›´æ¿€è¿›çš„ä¿®å¤
                        console.warn('ç¬¬ä¸€æ¬¡JSONè§£æå¤±è´¥ï¼Œå°è¯•ä¿®å¤:', parseError);
                        
                        // å°è¯•æå–æ­£ç å’Œç‰¹ç æ•°ç»„
                        const zhengmaMatch = jsonStr.match(/"æ­£ç "\s*:\s*\[([^\]]+)\]/);
                        const temaMatch = jsonStr.match(/"ç‰¹ç "\s*:\s*\[([^\]]+)\]/);
                        const yixiaoMatch = jsonStr.match(/"ä¸€è‚–"\s*:\s*"([^"]+)"/);
                        const texiaoMatch = jsonStr.match(/"ç‰¹è‚–"\s*:\s*"([^"]+)"/);
                        const lianxiaoMatch = jsonStr.match(/"è¿è‚–"\s*:\s*\[([^\]]+)\]/);
                        const lianweiMatch = jsonStr.match(/"è¿å°¾"\s*:\s*\[([^\]]+)\]/);
                        
                        if (zhengmaMatch || temaMatch) {
                            predictionData = {};
                            
                            // è§£ææ­£ç 
                            if (zhengmaMatch) {
                                const nums = zhengmaMatch[1].split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n >= 1 && n <= 49);
                                if (nums.length === 6) {
                                    predictionData.æ­£ç  = nums;
                                }
                            }
                            
                            // è§£æç‰¹ç 
                            if (temaMatch) {
                                const nums = temaMatch[1].split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n >= 1 && n <= 49);
                                if (nums.length > 0) {
                                    predictionData.ç‰¹ç  = nums;
                                }
                            }
                            
                            // è§£æç”Ÿè‚–ä¿¡æ¯
                            if (yixiaoMatch) {
                                predictionData.ä¸€è‚– = yixiaoMatch[1];
                            }
                            if (texiaoMatch) {
                                predictionData.ç‰¹è‚– = texiaoMatch[1];
                            }
                            if (lianxiaoMatch) {
                                const zodiacs = lianxiaoMatch[1].split(',').map(z => z.trim().replace(/["']/g, ''));
                                predictionData.è¿è‚– = zodiacs;
                            }
                            if (lianweiMatch) {
                                const tails = lianweiMatch[1].split(',').map(t => t.trim().replace(/["']/g, ''));
                                predictionData.è¿å°¾ = tails;
                            }
                            
                            // å¦‚æœä»ç„¶æ²¡æœ‰æ•°æ®ï¼ŒæŠ›å‡ºé”™è¯¯
                            if (!predictionData.æ­£ç  && !predictionData.ç‰¹ç ) {
                                throw new Error('æ— æ³•ä»å†…å®¹ä¸­æå–æœ‰æ•ˆæ•°æ®');
                            }
                    } else {
                            throw parseError;
                        }
                    }
                    
                    // éªŒè¯å’Œä¿®å¤æ•°æ®
                    if (!predictionData.æ­£ç  || !Array.isArray(predictionData.æ­£ç ) || predictionData.æ­£ç .length !== 6) {
                        // å¦‚æœæ²¡æœ‰æ­£ç æˆ–æ ¼å¼ä¸å¯¹ï¼Œç”Ÿæˆé»˜è®¤å€¼
                        const defaultNums = [];
                        while (defaultNums.length < 6) {
                            const num = Math.floor(Math.random() * 49) + 1;
                            if (!defaultNums.includes(num)) {
                                defaultNums.push(num);
                            }
                        }
                        predictionData.æ­£ç  = defaultNums;
                    }
                    
                    // ç¡®ä¿ç‰¹ç æ˜¯æ•°ç»„ä¸”ä¸º10ä¸ª
                    if (!predictionData.ç‰¹ç  || !Array.isArray(predictionData.ç‰¹ç )) {
                        if (typeof predictionData.ç‰¹ç  === 'number') {
                            predictionData.ç‰¹ç  = [predictionData.ç‰¹ç ];
                        } else {
                            predictionData.ç‰¹ç  = [];
                        }
                    }
                    
                    // è½¬æ¢å’Œè¿‡æ»¤æ— æ•ˆå·ç ï¼ˆç¡®ä¿æ˜¯1-49ä¹‹é—´çš„æ•´æ•°ï¼‰
                    predictionData.ç‰¹ç  = predictionData.ç‰¹ç .map(n => {
                        if (typeof n === 'string') {
                            // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•è½¬æ¢ä¸ºæ•°å­—
                            const num = parseInt(n);
                            return isNaN(num) ? null : num;
                        }
                        return typeof n === 'number' ? n : null;
                    }).filter(n => n !== null && n >= 1 && n <= 49);
                    
                    // ç¡®ä¿ç‰¹ç ä¸ä¸æ­£ç é‡å¤
                    predictionData.ç‰¹ç  = predictionData.ç‰¹ç .filter(n => !predictionData.æ­£ç .includes(n));
                    
                    // å»é‡
                    predictionData.ç‰¹ç  = [...new Set(predictionData.ç‰¹ç )];
                    
                    // å¦‚æœä¸è¶³10ä¸ªï¼ŒåŸºäºå†å²è®°å½•è¡¥å……
                    if (predictionData.ç‰¹ç .length < 10 && state.history.length > 0) {
                        // ç»Ÿè®¡å†å²è®°å½•ä¸­ç‰¹ç çš„å‡ºç°é¢‘ç‡
                        const specialFrequency = {};
                        state.history.forEach(item => {
                            if (item.special) {
                                specialFrequency[item.special] = (specialFrequency[item.special] || 0) + 1;
                            }
                        });
                        
                        // è·å–å€™é€‰å·ç ï¼ˆæ’é™¤å·²é€‰çš„æ­£ç å’Œç‰¹ç ï¼‰
                        const candidates = [];
                        for (let i = 1; i <= 49; i++) {
                            if (!predictionData.æ­£ç .includes(i) && !predictionData.ç‰¹ç .includes(i)) {
                                candidates.push({
                                    number: i,
                                    frequency: specialFrequency[i] || 0
                                });
                            }
                        }
                        
                        // æŒ‰é¢‘ç‡æ’åºï¼Œä¼˜å…ˆé€‰æ‹©å‡ºç°é¢‘ç‡é€‚ä¸­çš„å·ç 
                        candidates.sort((a, b) => {
                            // ä¼˜å…ˆé€‰æ‹©é¢‘ç‡ä¸ä¸º0ä½†ä¹Ÿä¸å¤ªé«˜ï¼ˆé¿å…è¿‡çƒ­ï¼‰çš„å·ç 
                            if (a.frequency === 0 && b.frequency > 0) return 1;
                            if (a.frequency > 0 && b.frequency === 0) return -1;
                            return Math.abs(a.frequency - 1) - Math.abs(b.frequency - 1);
                        });
                        
                        // è¡¥å……åˆ°10ä¸ª
                        while (predictionData.ç‰¹ç .length < 10 && candidates.length > 0) {
                            const candidate = candidates.shift();
                            predictionData.ç‰¹ç .push(candidate.number);
                        }
                    }
                    
                    // å¦‚æœä»ç„¶ä¸è¶³10ä¸ªï¼Œéšæœºè¡¥å……
                    while (predictionData.ç‰¹ç .length < 10) {
                        const num = Math.floor(Math.random() * 49) + 1;
                        if (!predictionData.ç‰¹ç .includes(num) && !predictionData.æ­£ç .includes(num)) {
                            predictionData.ç‰¹ç .push(num);
                        }
                    }
                    // åªä¿ç•™10ä¸ª
                    predictionData.ç‰¹ç  = predictionData.ç‰¹ç .slice(0, 10);
                    
                    // ä¿å­˜é¢„æµ‹ç»“æœ
                    state.prediction = predictionData;
                    
                    // æ ¼å¼åŒ–æ˜¾ç¤ºåœ¨ä¸‹æœŸé¢„æµ‹åŒºåŸŸ
                    const formattedHtml = formatAIPredictionForSection(predictionData);
                    predictionSection.innerHTML = formattedHtml;
                    
                    showToast('AIé¢„æµ‹å®Œæˆï¼', 'success');
                } catch (jsonError) {
                    console.error('JSONè§£æé”™è¯¯è¯¦æƒ…:', jsonError);
                    console.error('åŸå§‹å†…å®¹:', content);
                    throw new Error(`JSONè§£æå¤±è´¥ï¼š${jsonError.message}`);
                }
            } catch (error) {
                console.error('AIé¢„æµ‹å¤±è´¥:', error);
                predictionSection.innerHTML = `<div style="color: #e74c3c; padding: 20px; text-align: center;">âŒ AIé¢„æµ‹å¤±è´¥ï¼š${error.message}<br><br>è¯·æ£€æŸ¥ï¼š<br>1. Tokenæ˜¯å¦æ­£ç¡®<br>2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸<br>3. APIæœåŠ¡æ˜¯å¦å¯ç”¨</div>`;
                showToast('AIé¢„æµ‹å¤±è´¥ï¼', 'error');
            } finally {
                predictBtn.disabled = false;
                predictBtn.textContent = 'ğŸš€ AIæ™ºèƒ½é¢„æµ‹';
            }
        }

        // è§£æå¼€å¥–å·ç ï¼ˆå‚è€ƒPythonä»£ç çš„è§£æé€»è¾‘ï¼‰
        function parseOpenCode(openCode) {
            if (!openCode) return [];
            
            const numbers = [];
            
            // å¤„ç†å­—ç¬¦ä¸²æ ¼å¼
            if (typeof openCode === 'string') {
                const cleaned = openCode.replace(/[\[\]"\']/g, '').trim();
                const parts = cleaned.split(',');
                for (const part of parts) {
                    const numStr = part.trim();
                    if (numStr.match(/^\d+$/)) {
                        numbers.push(parseInt(numStr));
                    } else if (numStr.length >= 2 && numStr.startsWith('0') && numStr.slice(1).match(/^\d+$/)) {
                        numbers.push(parseInt(numStr));
                    }
                }
            } else if (Array.isArray(openCode)) {
                // å¤„ç†æ•°ç»„æ ¼å¼
                for (const num of openCode) {
                    if (typeof num === 'number') {
                        numbers.push(num);
                    } else if (typeof num === 'string') {
                        const numStr = num.trim();
                        if (numStr.match(/^\d+$/)) {
                            numbers.push(parseInt(numStr));
                        } else if (numStr.length >= 2 && numStr.startsWith('0') && numStr.slice(1).match(/^\d+$/)) {
                            numbers.push(parseInt(numStr));
                        }
                    }
                }
            }
            
            return numbers;
        }

        // è·å–å…­åˆå½©æ•°æ®
        async function fetchLotteryData() {
            try {
                let apiData = null;
                
                // å°è¯•ä»çœŸå®APIè·å–
                try {
                    const timestamp = Date.now();
                    const response = await fetch(`https://macaumarksix.com/api/live2?time=${timestamp}`, {
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                            'Origin': 'https://macaujc.com',
                            'Referer': 'https://macaujc.com/'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        // å¤„ç†è¿”å›çš„æ•°æ®æ ¼å¼ï¼ˆå¯èƒ½æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼‰
                        if (Array.isArray(data) && data.length > 0) {
                            apiData = data[0];
                        } else if (typeof data === 'object') {
                            apiData = data.data || data;
                        }
                    }
                } catch (apiError) {
                    console.warn('APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', apiError);
                    // APIå¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    apiData = {
                        expect: '2026360',
                        openCode: '27,06,44,15,39,12,41',
                        openTime: new Date().toISOString()
                    };
                }

                // è§£ææ•°æ®
                if (apiData && apiData.expect) {
                    const drawnIssue = String(apiData.expect);
                    
                    // è®¡ç®—å½“å‰æœŸå·ï¼ˆä¸‹ä¸€æœŸï¼‰
                    try {
                        if (drawnIssue.length >= 3) {
                            const issueNum = parseInt(drawnIssue.slice(-3));
                            const prefix = drawnIssue.slice(0, -3);
                            state.currentPeriod = prefix + String(issueNum + 1).padStart(3, '0');
                        } else {
                            state.currentPeriod = drawnIssue;
                        }
                    } catch (e) {
                        state.currentPeriod = drawnIssue;
                    }
                    
                    // è§£æå¼€å¥–æ—¶é—´å¹¶è®¡ç®—ä¸‹ä¸€æœŸå¼€å¥–æ—¶é—´
                    const openTimeStr = apiData.openTime || apiData.drawTime || apiData.time || new Date().toISOString();
                    let openTime;
                    
                    // å°è¯•è§£æä¸åŒæ ¼å¼çš„æ—¶é—´
                    try {
                        openTime = new Date(openTimeStr);
                        if (isNaN(openTime.getTime())) {
                            // å°è¯•å…¶ä»–æ ¼å¼
                            openTime = new Date(openTimeStr.replace('T', ' ').split('.')[0]);
                        }
                    } catch (e) {
                        openTime = new Date();
                    }
                    
                    // æ–°æ¾³é—¨å…­åˆå½©æ¯å¤©å¼€ä¸€æ¬¡ï¼ˆ24å°æ—¶åï¼‰
                    state.nextDrawTime = new Date(openTime.getTime() + 24 * 60 * 60 * 1000);
                    
                    // è§£æä¸Šä¸€æœŸç»“æœ
                    const openCode = apiData.openCode || apiData.result || apiData.numbers || apiData.code || '';
                    if (openCode) {
                        const numbers = parseOpenCode(openCode);
                        if (numbers.length >= 7) {
                            state.lastResult = {
                                period: drawnIssue,
                                numbers: numbers.slice(0, 6),
                                special: numbers[6] || numbers[numbers.length - 1],
                                time: openTimeStr
                            };
                        }
                    }
                }

                updateUI();
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
            }
        }

        // è§£æå†å²è®°å½•æ•°æ®ï¼ˆå‚è€ƒPythonä»£ç çš„è§£æé€»è¾‘ï¼‰
        function parseHistoryData(data) {
            const historyList = [];
            
            // å¤„ç†ä¸åŒæ ¼å¼çš„æ•°æ®
            let dataList = [];
            if (Array.isArray(data)) {
                dataList = data;
            } else if (data && typeof data === 'object') {
                // å°è¯•ä»ä¸åŒå­—æ®µè·å–åˆ—è¡¨
                if (data.data && Array.isArray(data.data)) {
                    dataList = data.data;
                } else if (data.list && Array.isArray(data.list)) {
                    dataList = data.list;
                } else if (data.history && Array.isArray(data.history)) {
                    dataList = data.history;
                } else if (data.results && Array.isArray(data.results)) {
                    dataList = data.results;
                }
            }
            
            // è§£ææ¯æ¡å†å²è®°å½•
            for (const item of dataList) {
                try {
                    // è·å–æœŸå·
                    const period = String(item.expect || item.issue || item.period || item.draw || item.number || item.drawNumber || item.drawNo || '');
                    
                    // è·å–å¼€å¥–å·ç ï¼ˆä¼˜å…ˆopenCodeå­—æ®µï¼‰
                    const result = item.openCode || item.result || item.numbers || item.number || item.code || item.drawCode || item.winningNumbers || '';
                    
                    // è§£æå·ç 
                    let numbers = [];
                    if (typeof result === 'string') {
                        // å­—ç¬¦ä¸²æ ¼å¼: "27,06,44,15,39,12,41" æˆ– "[1,2,3,4,5,6,7]"
                        const cleaned = result.replace(/[\[\]"\']/g, '').trim();
                        const parts = cleaned.split(',');
                        for (const part of parts) {
                            const numStr = part.trim();
                            if (numStr.match(/^\d+$/)) {
                                numbers.push(parseInt(numStr));
                            } else if (numStr.length >= 2 && numStr.startsWith('0') && numStr.slice(1).match(/^\d+$/)) {
                                numbers.push(parseInt(numStr));
                            }
                        }
                    } else if (Array.isArray(result)) {
                        // æ•°ç»„æ ¼å¼
                        for (const num of result) {
                            if (typeof num === 'number') {
                                numbers.push(num);
                            } else if (typeof num === 'string') {
                                const numStr = num.trim();
                                if (numStr.match(/^\d+$/)) {
                                    numbers.push(parseInt(numStr));
                                } else if (numStr.length >= 2 && numStr.startsWith('0') && numStr.slice(1).match(/^\d+$/)) {
                                    numbers.push(parseInt(numStr));
                                }
                            }
                        }
                    }
                    
                    // å¦‚æœå·ç æ•°é‡ä¸è¶³ï¼Œå°è¯•ä»å•ç‹¬å­—æ®µè·å–
                    if (numbers.length < 7) {
                        for (let i = 1; i <= 7; i++) {
                            const num = item[`num${i}`] || item[`number${i}`] || item[`n${i}`] || item[`ball${i}`];
                            if (num !== undefined && num !== null) {
                                const numValue = parseInt(num);
                                if (!isNaN(numValue) && !numbers.includes(numValue)) {
                                    numbers.push(numValue);
                                }
                            }
                        }
                    }
                    
                    // ç¡®ä¿æœ‰7ä¸ªå·ç ï¼ˆ6ä¸ªå¹³ç  + 1ä¸ªç‰¹ç ï¼‰
                    if (numbers.length >= 7) {
                        const drawTime = item.openTime || item.drawTime || item.time || item.date || item.drawDate || new Date().toISOString();
                        
                        historyList.push({
                            period: period,
                            time: drawTime,
                            numbers: numbers.slice(0, 6), // å‰6ä¸ªæ˜¯å¹³ç 
                            special: numbers[6] || numbers[numbers.length - 1] // ç¬¬7ä¸ªæ˜¯ç‰¹ç 
                        });
                    }
                } catch (error) {
                    console.error('è§£æå†å²è®°å½•é¡¹å¤±è´¥:', error, item);
                }
            }
            
            // æŒ‰æœŸå·å€’åºæ’åˆ—ï¼ˆå¤§çš„åœ¨ä¸Šï¼‰
            historyList.sort((a, b) => {
                const aPeriod = parseInt(a.period.replace(/-/g, '')) || 0;
                const bPeriod = parseInt(b.period.replace(/-/g, '')) || 0;
                return bPeriod - aPeriod;
            });
            
            // åªä¿ç•™æœ€è¿‘50æ¡
            return historyList.slice(0, 50);
        }

        // è·å–å†å²è®°å½•
        async function fetchHistory() {
            try {
                // å®é™…APIè°ƒç”¨ï¼ˆéœ€è¦å¤„ç†CORSï¼‰
                let historyData = [];
                
                try {
                    // å°è¯•ä»çœŸå®APIè·å–
                    const response = await fetch('https://history.macaumarksix.com/history/macaujc2/y/2026', {
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                            'Origin': 'https://macaujc.com',
                            'Referer': 'https://macaujc.com/'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        historyData = parseHistoryData(data);
                    }
                } catch (apiError) {
                    console.warn('APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', apiError);
                    // APIå¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    const mockHistory = [];
                    const baseIssue = 360;
                    const currentDate = new Date();
                    
                    for (let i = 0; i < 50; i++) {
                        const issue = baseIssue - i;
                        const numbers = [];
                        while (numbers.length < 6) {
                            const num = Math.floor(Math.random() * 49) + 1;
                            if (!numbers.includes(num)) {
                                numbers.push(num);
                            }
                        }
                        const special = Math.floor(Math.random() * 49) + 1;
                        
                        const drawDate = new Date(currentDate.getTime() - i * 24 * 60 * 60 * 1000);
                        
                        mockHistory.push({
                            period: `2026${String(issue).padStart(3, '0')}`,
                            time: drawDate.toISOString(),
                            numbers: numbers,
                            special: special
                        });
                    }
                    
                    historyData = mockHistory.sort((a, b) => parseInt(b.period) - parseInt(a.period));
                }

                // è¿‡æ»¤å½“å‰æœŸå·å’Œæœ€æ–°å·²å¼€å¥–æœŸå·
                const filteredHistory = historyData.filter(item => {
                    const period = String(item.period);
                    const currentPeriod = state.currentPeriod ? String(state.currentPeriod) : '';
                    const lastDrawnPeriod = state.lastResult ? String(state.lastResult.period) : '';
                    
                    // æ¯”è¾ƒæœŸå·å3ä½
                    const periodSuffix = period.slice(-3);
                    const currentSuffix = currentPeriod.slice(-3);
                    const lastDrawnSuffix = lastDrawnPeriod.slice(-3);
                    
                    return periodSuffix !== currentSuffix && periodSuffix !== lastDrawnSuffix;
                });

                state.history = filteredHistory.length > 0 ? filteredHistory : historyData.slice(0, 50);
                updateHistoryTable();
            } catch (error) {
                console.error('è·å–å†å²è®°å½•å¤±è´¥:', error);
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°æœŸå·
            if (state.currentPeriod) {
                document.getElementById('currentPeriod').textContent = state.currentPeriod;
            }

            // æ›´æ–°ä¸Šä¸€æœŸç»“æœ
            if (state.lastResult) {
                updateLastResult();
            }
        }

        // æ›´æ–°ä¸Šä¸€æœŸç»“æœ
        function updateLastResult() {
            const container = document.getElementById('lastResult');
            const result = state.lastResult;
            
            let html = `<div style="margin-bottom: 10px;"><strong>æœŸå·ï¼š</strong>${result.period}</div>`;
            html += `<div style="margin-bottom: 15px;"><strong>å¼€å¥–æ—¶é—´ï¼š</strong>${formatDateTime(result.time)}</div>`;
            html += '<div style="margin-bottom: 10px;"><strong>å·ç ï¼š</strong></div>';
            html += '<div class="numbers-container">';
            
            result.numbers.forEach(num => {
                const color = getNumberColor(num);
                html += `<div class="number-ball ${color}">${String(num).padStart(2, '0')}</div>`;
            });
            
            html += '</div>';
            html += '<div style="margin-top: 15px;"><strong>ç‰¹ç ï¼š</strong></div>';
            html += `<div class="numbers-container">`;
            const specialColor = getNumberColor(result.special);
            html += `<div class="number-ball ${specialColor}">${String(result.special).padStart(2, '0')}</div>`;
            html += '</div>';
            
            container.innerHTML = html;
        }

        // æ›´æ–°å†å²è®°å½•è¡¨æ ¼
        function updateHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            const countLabel = document.getElementById('historyCount');
            
            if (state.history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">æš‚æ— å†å²è®°å½•</td></tr>';
                if (countLabel) countLabel.textContent = 'ï¼ˆå…± 0 æ¡ï¼‰';
                return;
            }

            let html = '';
            state.history.forEach(item => {
                html += '<tr>';
                html += `<td style="white-space: nowrap;">${item.period}</td>`;
                html += `<td style="white-space: nowrap;">${formatDateTime(item.time)}</td>`;
                html += '<td>';
                item.numbers.forEach(num => {
                    const color = getNumberColor(num);
                    html += `<span class="number-ball ${color}" style="width: 35px; height: 35px; font-size: 14px; margin-right: 5px; display: inline-flex;">${String(num).padStart(2, '0')}</span>`;
                });
                html += '</td>';
                const specialColor = getNumberColor(item.special);
                html += `<td><span class="number-ball ${specialColor}" style="width: 35px; height: 35px; font-size: 14px; display: inline-flex;">${String(item.special).padStart(2, '0')}</span></td>`;
                html += '<td style="color: #27ae60; font-weight: bold;">èƒœ</td>';
                html += '<td style="color: #27ae60; font-weight: bold;">100%</td>';
                html += '</tr>';
            });
            
            tbody.innerHTML = html;
            if (countLabel) countLabel.textContent = `ï¼ˆå…± ${state.history.length} æ¡ï¼‰`;
        }


        // è·å–å·ç é¢œè‰²
        function getNumberColor(number) {
            const redNumbers = [1, 2, 7, 8, 12, 13, 18, 19, 23, 24, 29, 30, 34, 35, 40, 45, 46];
            const blueNumbers = [3, 4, 9, 10, 14, 15, 20, 25, 26, 31, 36, 37, 41, 42, 47, 48];
            
            if (redNumbers.includes(number)) return 'red';
            if (blueNumbers.includes(number)) return 'blue';
            return 'green';
            }

        // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
        function updateDateDisplay() {
            const now = new Date();
            const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            
            document.getElementById('currentDate').textContent = 
                `ğŸ“† ${now.getFullYear()}å¹´${String(now.getMonth() + 1).padStart(2, '0')}æœˆ${String(now.getDate()).padStart(2, '0')}æ—¥ ${weekdays[now.getDay()]}`;

            // ç®€å•çš„å†œå†æ˜¾ç¤ºï¼ˆå®é™…åº”ç”¨ä¸­åº”è¯¥ä½¿ç”¨å†œå†åº“ï¼‰
            document.getElementById('lunarDate').textContent = 
                `ğŸŒ™ å†œå†ï¼š${getLunarDate(now)}`;
        }

        // è·å–å†œå†æ—¥æœŸ
        function getLunarDate(date) {
            // å†œå†æ•°æ®è¡¨ï¼ˆ1900-2100å¹´ï¼‰
            const lunarInfo = [
                0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
                0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977,
                0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970,
                0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950,
                0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557,
                0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5b0, 0x14573, 0x052b0, 0x0a9a8, 0x0e950, 0x06aa0,
                0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0,
                0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b6a0, 0x195a6,
                0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570,
                0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0,
                0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5,
                0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930,
                0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530,
                0x05aa0, 0x076a3, 0x096d0, 0x04bd7, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45,
                0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0,
                0x14b63, 0x09370, 0x049f8, 0x04970, 0x064b0, 0x168a6, 0x0ea50, 0x06b20, 0x1a6c4, 0x0aae0,
                0x0a2e0, 0x0d2e3, 0x0c960, 0x0d557, 0x0d4a0, 0x0da50, 0x05d55, 0x056a0, 0x0a6d0, 0x055d4,
                0x052d0, 0x0a9b8, 0x0a950, 0x0b4a0, 0x0b6a6, 0x0ad50, 0x055a0, 0x0aba4, 0x0a5b0, 0x052b0,
                0x0b273, 0x06930, 0x07337, 0x06aa0, 0x0ad50, 0x14b55, 0x04b60, 0x0a570, 0x054e4, 0x0d160,
                0x0e968, 0x0d520, 0x0daa0, 0x16aa6, 0x056d0, 0x04ae0, 0x0a9d4, 0x0a2d0, 0x0d150, 0x0f252,
                0x0d520, 0x0daa0, 0x16aa6, 0x056d0, 0x04ae0, 0x0a9d4, 0x0a2d0, 0x0d150, 0x0f252, 0x0d520
            ];
            
            const Gan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
            const Zhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
            const Animals = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];
            const lunarMonthNames = ['æ­£', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å', 'å†¬', 'è…Š'];
            const lunarDayNames = ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
                'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
                'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
            
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            if (year < 1900 || year > 2100) {
                return 'è¶…å‡ºèŒƒå›´';
            }
            
            // è®¡ç®—1900å¹´1æœˆ31æ—¥ï¼ˆå†œå†1900å¹´æ­£æœˆåˆä¸€ï¼‰åˆ°å½“å‰æ—¥æœŸçš„å¤©æ•°
            const baseDate = new Date(1900, 0, 31);
            const currentDate = new Date(year, month - 1, day);
            let offset = Math.floor((currentDate - baseDate) / (1000 * 60 * 60 * 24));
            
            // è®¡ç®—å†œå†å¹´ä»½å’Œæ—¥æœŸ
            let lunarYear = 1900;
            let lunarMonth = 1;
            let lunarDay = 1;
            let isLeapMonth = false;
            
            for (let y = 1900; y <= year && y < 2100; y++) {
                const yearInfo = lunarInfo[y - 1900];
                const leapMonth = yearInfo & 0xf;
                const leapMonthDays = leapMonth ? ((yearInfo >> 16) & 0x1 ? 30 : 29) : 0;
                
                // è®¡ç®—è¯¥å¹´å†œå†æ€»å¤©æ•°
                let yearDays = 0;
                for (let m = 1; m <= 12; m++) {
                    const monthDays = (yearInfo >> (16 - m)) & 0x1 ? 30 : 29;
                    yearDays += monthDays;
                }
                if (leapMonth > 0) {
                    yearDays += leapMonthDays;
                }
                
                if (offset < yearDays) {
                    lunarYear = y;
                    // è®¡ç®—å†œå†æœˆä»½å’Œæ—¥æœŸ
                    let monthOffset = 0;
                    for (let m = 1; m <= 12; m++) {
                        const monthDays = (yearInfo >> (16 - m)) & 0x1 ? 30 : 29;
                        if (offset < monthOffset + monthDays) {
                            lunarMonth = m;
                            lunarDay = offset - monthOffset + 1;
                            break;
                        }
                        monthOffset += monthDays;
                        
                        // å¤„ç†é—°æœˆ
                        if (leapMonth === m && offset >= monthOffset) {
                            if (offset < monthOffset + leapMonthDays) {
                                lunarMonth = m;
                                lunarDay = offset - monthOffset + 1;
                                isLeapMonth = true;
                                break;
                            }
                            monthOffset += leapMonthDays;
                        }
                    }
                    break;
                }
                offset -= yearDays;
        }

            // è®¡ç®—å¤©å¹²åœ°æ”¯
            const ganIndex = (lunarYear - 4) % 10;
            const zhiIndex = (lunarYear - 4) % 12;
            const ganZhi = Gan[ganIndex] + Zhi[zhiIndex];
            const animal = Animals[zhiIndex];
            
            // æ ¼å¼åŒ–æœˆä»½åç§°
            let monthName = lunarMonthNames[lunarMonth - 1];
            if (isLeapMonth) {
                monthName = 'é—°' + monthName;
            }
            
            // æ ¼å¼åŒ–æ—¥æœŸåç§°
            const dayName = lunarDayNames[lunarDay - 1] || ('åˆ' + lunarDay);
            
            return `${ganZhi}å¹´(${animal}å¹´) ${monthName}æœˆ${dayName}`;
        }

        // å¼€å§‹å€’è®¡æ—¶
        function startCountdown() {
            function updateCountdown() {
                if (!state.nextDrawTime) {
                    document.getElementById('countdown').textContent = '--';
                    return;
                }

                const now = new Date();
                const diff = state.nextDrawTime - now;

                if (diff <= 0) {
                    document.getElementById('countdown').textContent = 'å·²å¼€å¥–';
                    fetchLotteryData();
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                let countdownText = '';
                if (days > 0) countdownText += `${days}å¤© `;
                if (hours > 0) countdownText += `${hours}å°æ—¶ `;
                if (minutes > 0) countdownText += `${minutes}åˆ†é’Ÿ `;
                countdownText += `${seconds}ç§’`;

                document.getElementById('countdown').textContent = `â° è·ç¦»å¼€å¥–ï¼š${countdownText}`;
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s reverse';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'ğŸ”„ åˆ·æ–°ä¸­...';
            btn.disabled = true;

            Promise.all([fetchLotteryData(), fetchHistory()]).then(() => {
                btn.textContent = originalText;
                btn.disabled = false;
                showToast('æ•°æ®åˆ·æ–°æˆåŠŸï¼', 'success');
            }).catch((error) => {
                btn.textContent = originalText;
                btn.disabled = false;
                showToast('æ•°æ®åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                console.error('åˆ·æ–°å¤±è´¥:', error);
            });
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

    </script>
</body>
</html>
